var storageEngine = (function() {
    var e = {
        code: "STORAGE_API_NOT_SUPPORTED",
        message: "The storage engine has not been initialized",
      },
      t = { code: "STORAGE_API_NOT_INITIALIZED", message: "" },
      n = e => ({
        code: "STORE_NOT_INITIALIZED",
        message: `The object store ${e} has not been initialized`,
      }),
      a = !1,
      i = {}
    function o(e) {
      var t = localStorage.getItem(e)
      return JSON.parse(t)
    }
    return {
      init(t, n) {
        window.localStorage ? ((a = !0), t(null)) : n(e)
      },
      initObjectStore(e, n, o) {
        a
          ? localStorage.getItem(e) ||
            localStorage.setItem(e, JSON.stringify({}))
          : o(t),
          (i[e] = e),
          n(null)
      },
      findAll(e, s, r) {
        a ? i || r(n(e)) : r(t)
        var d = [],
          l = o(e)
        $.each(l, function(e, t) {
          d.push(t)
        }),
          s(d)
      },
      findById(e, s, r, d) {
        a ? i[e] || d(n(e)) : d(t), r(o(e)[s])
      },
      save(e, s, r, d) {
        a ? i[e] || d(n(e)) : d(t), s.id || (s.id = $.now())
        var l = o(e)
        ;(l[s.id] = s), localStorage.setItem(e, JSON.stringify(l)), r(s)
      },
      delete(e, s, r, d) {
        a ? i[e] || d(n(e)) : d(t)
        var l = o(e)
        l[s]
          ? (delete l[s], localStorage.setItem(e, JSON.stringify(l)), r(s))
          : d(
              (e => ({
                code: "OBJECT_NOT_FOUND",
                message: `The object store has no item with ${e}`,
              }))(s)
            )
      },
      findByProperty(e, s, r, d, l) {
        a ? i[e] || l(n(e)) : l(t)
        var c = [],
          f = o(e)
        $.each(f, function(e, t) {
          t[s] === r && c.push(t)
        }),
          d(c)
      },
    }
  })(),
  tasksController = (function() {
    function e(e) {
      console.log(`${e.code}: ${e.message}`)
    }
    var t,
      n = !1
    return {
      init: function(a) {
        storageEngine.init(function() {
          storageEngine.initObjectStore("task", function() {}, e)
        }, e),
          n ||
            ((t = a),
            $(t)
              .find('[required="required"]')
              .prev("label")
              .append("<span>*</span>")
              .children("span")
              .addClass("required"),
            $(t)
              .find("tbody tr:even")
              .addClass("even"),
            $(t)
              .find("#btnAddTask")
              .click(function(e) {
                e.preventDefault(),
                  $(t)
                    .find("#taskCreation")
                    .removeClass("not")
              }),
            $(t)
              .find("tbody tr")
              .click(function(e) {
                $(e.target)
                  .closest("td")
                  .siblings()
                  .andSelf()
                  .toggleClass("rowHighlight")
              }),
            $(t)
              .find("#tblTasks tbody")
              .on("click", ".editRow", function(n) {
                $(t)
                  .find("#taskCreation")
                  .removeClass("not"),
                  storageEngine.findById(
                    "task",
                    $(n.target).data().taskId,
                    function(e) {
                      $(t)
                        .find("form")
                        .fromObject(e)
                    },
                    e
                  )
              }),
            $(t)
              .find("#tblTasks tbody")
              .on("click", ".deleteRow", function(t) {
                storageEngine.delete(
                  "task",
                  $(t.target).data().taskId,
                  function() {
                    $(t.target)
                      .parents("tr")
                      .remove()
                  },
                  e
                )
              }),
            $(t)
              .find("#saveTask")
              .click(function(n) {
                if (
                  (n.preventDefault(),
                  $(t)
                    .find("form")
                    .valid())
                ) {
                  var a = $("form").toObject()
                  storageEngine.save(
                    "task",
                    a,
                    function(e) {
                      $("#taskRow")
                        .tmpl(e)
                        .appendTo($(t).find("#tblTasks tbody"))
                    },
                    e
                  )
                }
              }),
            (n = !0))
      },
      loadTasks: function() {
        storageEngine.findAll(
          "task",
          function(e) {
            $.each(e, function(e, n) {
              $("#taskRow")
                .tmpl(n)
                .appendTo($(t).find("#tblTasks tbody"))
            })
          },
          e
        )
      },
    }
  })()
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRhc2tzLXdlYnN0b3JhZ2UuanMiLCJ0YXNrcy1jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbInN0b3JhZ2VFbmdpbmUiLCJTVE9SQUdFX0FQSV9BVkFJTEFCSUxJVFlfRVJST1IiLCJjb2RlIiwibWVzc2FnZSIsIlNUT1JBR0VfQVBJX0lOSVRJQUxJWkFUSU9OX0VSUk9SIiwiT0JKRUNUX1NUT1JFX1RZUEVfSU5JVElBTElaQVRJT05fRVJST1IiLCJ0eXBlIiwiaW5pdGlhbGl6ZWQiLCJpbml0aWFsaXplZE9iamVjdFN0b3JlcyIsImdldFN0b3JhZ2VPYmplY3QiLCJzdG9yZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJKU09OIiwicGFyc2UiLCJbb2JqZWN0IE9iamVjdF0iLCJzdWNjZXNzQ2FsbGJhY2siLCJlcnJvckNhbGxiYWNrIiwid2luZG93Iiwic2V0SXRlbSIsInN0cmluZ2lmeSIsInJlc3VsdCIsIiQiLCJlYWNoIiwiXyIsInYiLCJwdXNoIiwiaWQiLCJvYmoiLCJub3ciLCJzdG9yYWdlSXRlbSIsIk9CSkVDVF9OT1RfRk9VTkRfRVJST1IiLCJwcm9wZXJ0eU5hbWUiLCJwcm9wZXJ0eVZhbHVlIiwidGFza3NDb250cm9sbGVyIiwiZXJyb3JMb2dnZXIiLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJ0YXNrUGFnZSIsImluaXRpYWxpc2VkIiwiaW5pdCIsInBhZ2UiLCJpbml0T2JqZWN0U3RvcmUiLCJmaW5kIiwicHJldiIsImFwcGVuZCIsImNoaWxkcmVuIiwiYWRkQ2xhc3MiLCJjbGljayIsImV2dCIsInByZXZlbnREZWZhdWx0IiwicmVtb3ZlQ2xhc3MiLCJ0YXJnZXQiLCJjbG9zZXN0Iiwic2libGluZ3MiLCJhbmRTZWxmIiwidG9nZ2xlQ2xhc3MiLCJvbiIsImZpbmRCeUlkIiwiZGF0YSIsInRhc2tJZCIsInRhc2siLCJmcm9tT2JqZWN0IiwiZGVsZXRlIiwicGFyZW50cyIsInJlbW92ZSIsInZhbGlkIiwidG9PYmplY3QiLCJzYXZlIiwic2F2ZWRUYXNrIiwidG1wbCIsImFwcGVuZFRvIiwibG9hZFRhc2tzIiwiZmluZEFsbCIsInRhc2tzIiwiaW5kZXgiXSwibWFwcGluZ3MiOiJBQVlBLElBQUFBLGNBQUEsV0FDQSxJQUFBQyxFQUFBLENBQ0FDLEtBQUEsNEJBQ0FDLFFBQUEsK0NBR0FDLEVBQUEsQ0FDQUYsS0FBQSw4QkFDQUMsUUFBQSxJQUdBRSxFQUFBQyxJQUNBLENBQ0FKLEtBQUEsd0JBQ0FDLFFBQUEsb0JBQUFHLCtCQVNBQyxHQUFBLEVBQ0FDLEVBQUEsR0FFQSxTQUFBQyxFQUFBSCxHQUNBLElBQUFJLEVBQUFDLGFBQUFDLFFBQUFOLEdBQ0EsT0FBQU8sS0FBQUMsTUFBQUosR0FvQkEsTUFBQSxDQWdCQUssS0FBQUMsRUFBQUMsR0FDQUMsT0FBQVAsY0FDQUosR0FBQSxFQUNBUyxFQUFBLE9BRUFDLEVBQUFoQixJQWlCQWMsZ0JBQUFULEVBQUFVLEVBQUFDLEdBQ0FWLEVBRUFJLGFBQUFDLFFBQUFOLElBQ0FLLGFBQUFRLFFBQUFiLEVBQUFPLEtBQUFPLFVBQUEsS0FGQUgsRUFBQWIsR0FJQUksRUFBQUYsR0FBQUEsRUFDQVUsRUFBQSxPQVlBRCxRQUFBVCxFQUFBVSxFQUFBQyxHQUNBVixFQUVBQyxHQUNBUyxFQUFBWixFQUFBQyxJQUZBVyxFQUFBYixHQUlBLElBQUFpQixFQUFBLEdBQ0FYLEVBQUFELEVBQUFILEdBQ0FnQixFQUFBQyxLQUFBYixHQUFBLFNBQUFjLEVBQUFDLEdBQ0FKLEVBQUFLLEtBQUFELE1BRUFULEVBQUFLLElBY0FOLFNBQUFULEVBQUFxQixFQUFBWCxFQUFBQyxHQUNBVixFQUVBQyxFQUFBRixJQUNBVyxFQUFBWixFQUFBQyxJQUZBVyxFQUFBYixHQUtBWSxFQURBUCxFQUFBSCxHQUNBcUIsS0FxQkFaLEtBQUFULEVBQUFzQixFQUFBWixFQUFBQyxHQUNBVixFQUVBQyxFQUFBRixJQUNBVyxFQUFBWixFQUFBQyxJQUZBVyxFQUFBYixHQUlBd0IsRUFBQUQsS0FDQUMsRUFBQUQsR0FBQUwsRUFB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ZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKlxuICogQG5hbWVzcGFjZSBTdG9yZUVuZ2luZSBUaGUgQVBJIGZvciBzdG9yaW5nIHVzZXIgZGF0YSBvbiB0aGUgY2xpZW50XG4gKlxuICogQG1ldGhvZCB7RnVuY3Rpb259IGluaXRcbiAqIEBtZXRob2Qge0Z1bmN0aW9ufSBpbml0T2JqZWN0U3RvcmVcbiAqIEBtZXRob2Qge0Z1bmN0aW9ufSBmaW5kQWxsXG4gKiBAbWV0aG9kIHtGdW5jdGlvbn0gZmluZEJ5SWRcbiAqIEBtZXRob2Qge0Z1bmN0aW9ufSBzYXZlXG4gKiBAbWV0aG9kIHtGdW5jdGlvbn0gZGVsZXRlXG4gKiBAbWV0aG9kIHtGdW5jdGlvbn0gZmluZEJ5UHJvcGVydHlcbiAqL1xudmFyIHN0b3JhZ2VFbmdpbmUgPSAoZnVuY3Rpb24oKSB7XG4gIHZhciBTVE9SQUdFX0FQSV9BVkFJTEFCSUxJVFlfRVJST1IgPSB7XG4gICAgY29kZTogXCJTVE9SQUdFX0FQSV9OT1RfU1VQUE9SVEVEXCIsXG4gICAgbWVzc2FnZTogXCJUaGUgc3RvcmFnZSBlbmdpbmUgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkXCIsXG4gIH1cblxuICB2YXIgU1RPUkFHRV9BUElfSU5JVElBTElaQVRJT05fRVJST1IgPSB7XG4gICAgY29kZTogXCJTVE9SQUdFX0FQSV9OT1RfSU5JVElBTElaRURcIixcbiAgICBtZXNzYWdlOiBcIlwiLFxuICB9XG5cbiAgdmFyIE9CSkVDVF9TVE9SRV9UWVBFX0lOSVRJQUxJWkFUSU9OX0VSUk9SID0gdHlwZSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvZGU6IFwiU1RPUkVfTk9UX0lOSVRJQUxJWkVEXCIsXG4gICAgICBtZXNzYWdlOiBgVGhlIG9iamVjdCBzdG9yZSAke3R5cGV9IGhhcyBub3QgYmVlbiBpbml0aWFsaXplZGAsXG4gICAgfVxuICB9XG4gIHZhciBPQkpFQ1RfTk9UX0ZPVU5EX0VSUk9SID0gaWQgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBjb2RlOiBcIk9CSkVDVF9OT1RfRk9VTkRcIixcbiAgICAgIG1lc3NhZ2U6IGBUaGUgb2JqZWN0IHN0b3JlIGhhcyBubyBpdGVtIHdpdGggJHtpZH1gLFxuICAgIH1cbiAgfVxuICB2YXIgaW5pdGlhbGl6ZWQgPSBmYWxzZVxuICB2YXIgaW5pdGlhbGl6ZWRPYmplY3RTdG9yZXMgPSB7fVxuXG4gIGZ1bmN0aW9uIGdldFN0b3JhZ2VPYmplY3QodHlwZSkge1xuICAgIHZhciBzdG9yZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHR5cGUpXG4gICAgcmV0dXJuIEpTT04ucGFyc2Uoc3RvcmUpXG4gIH1cblxuICAvKipcbiAgICogVGhpcyB3aWxsIGJlIGNhbGxlZCBpbiBhbGwgc3VjY2VzcyBzY2VuYXJpb3NcbiAgICogQGNhbGxiYWNrIFN1Y2Nlc3NDYWxsYmFja1xuICAgKiBAcGFyYW0ge2FueX0gcmVzdWx0IFRoZSBzdWNjZXNzIHJlc3VsdCwgYXMgZG9jdW1lbnRlZCBvbiBpbmRpdmlkdWFsIG1ldGhvZCBjYWxsc1xuICAgKi9cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gRXJyb3JPYmplY3QgLSBUaGUgc2hhcGUgb2YgYWxsIGVycm9ycyByZXR1cm5lZCBmcm9tIHRoZSBBUEkgb24gZmFpbHVyZVxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gY29kZSAtIFRoZSB0eXBlIG9mIGV4Y2VwdGlvblxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gbWVzc2FnZSAtIEEgaHVtYW4gcmVhZGFibGUgdmVyc2lvbiBvZiB0aGUgZXJyb3IgbWVzc2FnZVxuICAgKi9cblxuICAvKipcbiAgICogVGhpcyB3aWxsIGJlIGNhbGxlZCBpbiBhbGwgZmFpbHVyZSBzY2VuYXJpb3NcbiAgICogQGNhbGxiYWNrIEVycm9yQ2FsbGJhY2tcbiAgICogQHBhcmFtIHtFcnJvck9iamVjdH0gZXJyb3IgSW5mb3JtYXRpb24gYWJvdXQgdGhlIGZhaWx1cmVcbiAgICovXG4gIHJldHVybiB7XG4gICAgLyoqXG4gICAgICogVGhlIGNsaWVudCBtdXN0IGNhbGwgdGhpcyB0byBpbml0aWFsaXplIHRoZSBzdG9yYWdlIGVuZ2luZSBiZWZvcmUgdXNpbmcgaXQuXG4gICAgICpcbiAgICAgKiBJZiB0aGUgc3RvcmFnZSBlbmdpbmUgaW5pdGlhbGl6ZXMgc3VjY2Vzc2Z1bGx5IHRoZSBzdWNjZXNzQ2FsbGJhY2sgd2lsbCBiZVxuICAgICAqIGludm9rZWQgd2l0aCBhIG51bGwgb2JqZWN0LlxuICAgICAqXG4gICAgICogSWYgdGhlIGVycm9yQ2FsbGJhY2sgaXMgaW52b2tlZCB0aGVuIHRoZSBzdG9yYWdlIGVuZ2luZVxuICAgICAqIGNhbm5vdCBiZSB1c2VkLlxuICAgICAqXG4gICAgICogSXQgc2hvdWxkIGJlIHBvc3NpYmxlIHRvIGNhbGwgdGhpcyBtZXRob2QgbXVsdGlwbGUgdGltZXMsXG4gICAgICogYW5kIHRoZSBzYW1lIHJlc3VsdCB3aWxsIGJlIHJldHVybmVkIGVhY2ggdGltZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3VjY2Vzc0NhbGxiYWNrfSBzdWNjZXNzQ2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRoYXQgd2lsbCBiZSBpbnZva2VkIGlmIHRoZSBzdG9yYWdlIGVuZ2luZSBpbml0aWFsaXplcy5cbiAgICAgKiBAcGFyYW0ge0Vycm9yQ2FsbGJhY2t9IGVycm9yQ2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRoYXQgd2lsbCBiZSBpbnZva2VkIGluIGVycm9yIHNjZW5hcmlvcy5cbiAgICAgKi9cbiAgICBpbml0KHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xuICAgICAgaWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgaW5pdGlhbGl6ZWQgPSB0cnVlXG4gICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhudWxsKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZXJyb3JDYWxsYmFjayhTVE9SQUdFX0FQSV9BVkFJTEFCSUxJVFlfRVJST1IpXG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFRoZSBjbGllbnQgbXVzdCBjYWxsIHRoaXMgdG8gaW5pdGlhbGl6ZSBhIHNwZWNpZmljIG9iamVjdCB0eXBlIGluIHRoZSBzdG9yYWdlIGVuZ2luZS5cbiAgICAgKlxuICAgICAqIElmIHRoZSBzdG9yYWdlIGVuZ2luZSBzdXBwb3J0cyB0aGUgb2JqZWN0IHR5cGUgdGhlIHN1Y2Nlc3NDYWxsYmFjayB3aWxsIGJlIGludm9rZWQgd2l0aCBhIG51bGwgdmFsdWUuXG4gICAgICpcbiAgICAgKiBJZiB0aGUgZXJyb3JDYWxsYmFjayBpcyBpbnZva2VkIHRoZW4gdGhlIG9iamVjdCB0eXBlIGNhbm5vdCBiZSBzdG9yZWRcbiAgICAgKlxuICAgICAqIEl0IHNob3VsZCBiZSBwb3NzaWJsZSB0byBjYWxsIHRoaXMgbWV0aG9kIG11bHRpcGxlIHRpbWVzLCBhbmQgdGhlIHNhbWUgcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQgZWFjaCB0aW1lLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIHR5cGUgb2Ygb2JqZWN0IHRoYXQgd2lsbCBiZSBzdG9yZWQuXG4gICAgICogQHBhcmFtIHtTdWNjZXNzQ2FsbGJhY2t9IHN1Y2Nlc3NDYWxsYmFjayBUaGUgY2FsbGJhY2sgdGhhdCB3aWxsIGJlIGludm9rZWQgaWYgdGhlIHN0b3JhZ2UgZW5naW5lIGluaXRpYWxpemVzLlxuICAgICAqIEBwYXJhbSB7RXJyb3JDYWxsYmFja30gZXJyb3JDYWxsYmFjayBUaGUgY2FsbGJhY2sgdGhhdCB3aWxsIGJlIGludm9rZWQgb24gZXJyb3Igc2NlbmFyaW9zLlxuICAgICAqL1xuICAgIGluaXRPYmplY3RTdG9yZSh0eXBlLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcbiAgICAgIGlmICghaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgZXJyb3JDYWxsYmFjayhTVE9SQUdFX0FQSV9JTklUSUFMSVpBVElPTl9FUlJPUilcbiAgICAgIH0gZWxzZSBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKHR5cGUpKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHR5cGUsIEpTT04uc3RyaW5naWZ5KHt9KSlcbiAgICAgIH1cbiAgICAgIGluaXRpYWxpemVkT2JqZWN0U3RvcmVzW3R5cGVdID0gdHlwZVxuICAgICAgc3VjY2Vzc0NhbGxiYWNrKG51bGwpXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFRoaXMgY2FuIGJlIHVzZWQgdG8gZmluZCBhbGwgdGhlIG9iamVjdHMgZm9yIGEgc3BlY2lmaWMgdHlwZS5cbiAgICAgKiBJZiB0aGVyZSBhcmUgbm8gb2JqZWN0cyBmb3VuZCBmb3IgdGhhdCB0eXBlIHRoaXMgd2lsbCByZXR1cm4gYW4gZW1wdHkgYXJyYXkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiBvYmplY3QgdGhhdCBzaG91bGQgYmUgc2VhcmNoZWQgZm9yLlxuICAgICAqIEBwYXJhbSB7U3VjY2Vzc0NhbGxiYWNrfSBzdWNjZXNzQ2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRoYXQgd2lsbCBiZSBpbnZva2VkIGFmdGVyIGEgcXVlcnkgY29tcGxldGVzLlxuICAgICAqIFRoaXMgd2lsbCBiZSBwYXNzZWQgYW4gYXJyYXkgb2Ygb2JqZWN0cyBjb25mb3JtaW5nIHRvIHRoZSByZXF1ZXN0ZWQgdHlwZS5cbiAgICAgKiBAcGFyYW0ge0Vycm9yQ2FsbGJhY2t9IGVycm9yQ2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRoYXQgd2lsbCBiZSBpbnZva2VkIG9uIGVycm9yIHNjZW5hcmlvcy5cbiAgICAgKi9cbiAgICBmaW5kQWxsKHR5cGUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xuICAgICAgaWYgKCFpbml0aWFsaXplZCkge1xuICAgICAgICBlcnJvckNhbGxiYWNrKFNUT1JBR0VfQVBJX0lOSVRJQUxJWkFUSU9OX0VSUk9SKVxuICAgICAgfSBlbHNlIGlmICghaW5pdGlhbGl6ZWRPYmplY3RTdG9yZXMpIHtcbiAgICAgICAgZXJyb3JDYWxsYmFjayhPQkpFQ1RfU1RPUkVfVFlQRV9JTklUSUFMSVpBVElPTl9FUlJPUih0eXBlKSlcbiAgICAgIH1cbiAgICAgIHZhciByZXN1bHQgPSBbXVxuICAgICAgdmFyIHN0b3JlID0gZ2V0U3RvcmFnZU9iamVjdCh0eXBlKVxuICAgICAgJC5lYWNoKHN0b3JlLCBmdW5jdGlvbihfLCB2KSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHYpXG4gICAgICB9KVxuICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJlc3VsdClcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVGhpcyB3aWxsIHJldHVybiBhbiBvYmplY3Qgd2l0aCBhIHNwZWNpZmljIGlkIGZvciBhIHNwZWNpZmljIHR5cGUuXG4gICAgICogSWYgbm8gb2JqZWN0IGlzIGZvdW5kIHRoaXMgd2lsbCByZXR1cm4gbnVsbC5cbiAgICAgKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgVGhlIHR5cGUgb2Ygb2JqZWN0IHRoYXQgc2hvdWxkIHNlYXJjaGVkIGZvclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gaWQgVGhlIHVuaXF1ZSBJRCBvZiB0aGUgb2JqZWN0XG4gICAgICogQHBhcmFtIHtTdWNjZXNzQ2FsbGJhY2t9IHN1Y2Nlc3NDYWxsYmFjayBUaGUgY2FsbGJhY2sgdGhhdCB3aWxsIGJlIGludm9rZWQgYWZ0ZXIgdGhlIHF1ZXJ5IGNvbXBsZXRlcy5cbiAgICAgKiBUaGlzIHdpbGwgYmUgcGFzc2VkIGFuIG9iamVjdCBjb25mb3JtaW5nIHRvIHRoZSByZXF1ZXN0ZWQgdHlwZSBvciBudWxsLlxuICAgICAqIEBwYXJhbSB7RXJyb3JDYWxsYmFja30gZXJyb3JDYWxsYmFjayBUaGUgY2FsbGJhY2sgdGhhdCB3aWxsIGJlIGludm9rZWQgb24gZXJyb3Igc2NlbmFyaW9zLlxuICAgICAqL1xuICAgIGZpbmRCeUlkKHR5cGUsIGlkLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcbiAgICAgIGlmICghaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgZXJyb3JDYWxsYmFjayhTVE9SQUdFX0FQSV9JTklUSUFMSVpBVElPTl9FUlJPUilcbiAgICAgIH0gZWxzZSBpZiAoIWluaXRpYWxpemVkT2JqZWN0U3RvcmVzW3R5cGVdKSB7XG4gICAgICAgIGVycm9yQ2FsbGJhY2soT0JKRUNUX1NUT1JFX1RZUEVfSU5JVElBTElaQVRJT05fRVJST1IodHlwZSkpXG4gICAgICB9XG4gICAgICB2YXIgc3RvcmUgPSBnZXRTdG9yYWdlT2JqZWN0KHR5cGUpXG4gICAgICBzdWNjZXNzQ2FsbGJhY2soc3RvcmVbaWRdKVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIFRoaXMgd2lsbCBoYW5kbGUgYWRkaW5nIGFuZCBlZGl0aW5nIG9iamVjdHMgb2YgYSBzcGVjaWZpYyB0eXBlLlxuICAgICAqXG4gICAgICogSWYgdGhlIGlkIHByb3BlcnR5IG9mIHRoZSBvYmplY3QgcGFzc2VkIGluXG4gICAgICogaXMgbnVsbCBvciB1bmRlZmluZWQsIGFuIGlkIHdpbGwgYmUgYXNzaWduZWQgZm9yIHRoZSBvYmplY3QsIGFuZCBpdCB3aWxsIGJlIHNhdmVkLlxuICAgICAqXG4gICAgICogSWYgdGhlIGlkIHByb3BlcnR5IGlzIG5vbi1udWxsIHRoZW4gdGhlIG9iamVjdCB3aWxsIGJlIHVwZGF0ZWRcbiAgICAgKlxuICAgICAqIElmIHRoZSBpZCBjYW5ub3QgYmUgZm91bmQgdGhlIGVycm9yIGNhbGxiYWNrIHdpbGwgYmUgaW52b2tlZC5cbiAgICAgKiBPbiBzdWNjZXNzLCB0aGUgbmV3bHkgc2F2ZWQgb2JqZWN0IHdpbGwgYmUgcmV0dXJuZWQgdG8gdGhlIHN1Y2Nlc3MgY2FsbGJhY2suXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiBvYmplY3QgdGhhdCB3aWxsIGJlIHN0b3JlZC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgdGhhdCB3aWxsIGJlIHN0b3JlZC5cbiAgICAgKiBAcGFyYW0ge1N1Y2Nlc3NDYWxsYmFja30gc3VjY2Vzc0NhbGxiYWNrIFRoZSBjYWxsYmFjayB0aGF0IHdpbGwgYmUgaW52b2tlZCBhZnRlciB0aGUgb2JqZWN0IGhhcyBiZWVuXG4gICAgICogY29tbWl0dGVkIHRvIHRoZSBzdG9yYWdlIGVuZ2luZS4gVGhpcyB3aWxsIGJlIHRoZSBzdG9yZWQgb2JqZWN0LCBpbmNsdWRpbmcgdGhlIGlkIHByb3BlcnR5LlxuICAgICAqIEBwYXJhbSB7RXJyb3JDYWxsYmFja30gZXJyb3JDYWxsYmFjayBUaGUgY2FsbGJhY2sgdGhhdCB3aWxsIGJlIGludm9rZWQgb24gZXJyb3Igc2NlbmFyaW9zLlxuICAgICAqL1xuICAgIHNhdmUodHlwZSwgb2JqLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcbiAgICAgIGlmICghaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgZXJyb3JDYWxsYmFjayhTVE9SQUdFX0FQSV9JTklUSUFMSVpBVElPTl9FUlJPUilcbiAgICAgIH0gZWxzZSBpZiAoIWluaXRpYWxpemVkT2JqZWN0U3RvcmVzW3R5cGVdKSB7XG4gICAgICAgIGVycm9yQ2FsbGJhY2soT0JKRUNUX1NUT1JFX1RZUEVfSU5JVElBTElaQVRJT05fRVJST1IodHlwZSkpXG4gICAgICB9XG4gICAgICBpZiAoIW9iai5pZCkge1xuICAgICAgICBvYmouaWQgPSAkLm5vdygpXG4gICAgICB9XG4gICAgICB2YXIgc3RvcmFnZUl0ZW0gPSBnZXRTdG9yYWdlT2JqZWN0KHR5cGUpXG4gICAgICBzdG9yYWdlSXRlbVtvYmouaWRdID0gb2JqXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0eXBlLCBKU09OLnN0cmluZ2lmeShzdG9yYWdlSXRlbSkpXG4gICAgICBzdWNjZXNzQ2FsbGJhY2sob2JqKVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBUaGlzIHdpbGwgZGVsZXRlIGFuIG9iamVjdCB3aXRoIGEgc3BlY2lmaWMgaWQgZm9yIGEgc3BlY2lmaWMgdHlwZS5cbiAgICAgKlxuICAgICAqIElmIG5vIG9iamVjdCBleGlzdHMgd2l0aCB0aGF0IGlkLCB0aGUgZXJyb3IgY2FsbGJhY2sgd2lsbCBiZSBpbnZva2VkLlxuICAgICAqXG4gICAgICogSWYgYW4gb2JqZWN0IGlzIGRlbGV0ZWQgdGhpcyBmdW5jdGlvbiB3aWxsXG4gICAgICogcmV0dXJuIHRoZSBpZCBvZiB0aGUgZGVsZXRlZCBvYmplY3QgdG8gdGhlIHN1Y2Nlc3MgY2FsbGJhY2suXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiBvYmplY3QgdGhhdCB3aWxsIGJlIGRlbGV0ZWQuXG4gICAgICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBpZCBUaGUgdW5pcXVlIGlkIG9mIHRoZSBvYmplY3RcbiAgICAgKiBAcGFyYW0ge1N1Y2Nlc3NDYWxsYmFja30gc3VjY2Vzc0NhbGxiYWNrIFRoZSBjYWxsYmFja1xuICAgICAqIHRoYXQgd2lsbCBiZSBpbnZva2VkIGFmdGVyIHRoZSBvYmplY3QgaGFzIGJlZW4gZGVsZXRlZCBmcm9tIHRoZSBzdG9yYWdlIGVuZ2luZS5cbiAgICAgKiBUaGlzIHdpbGwgYmUgcGFzc2VkIHRoZSB1bmlxdWUgaWQgb2YgdGhlIGRlbGV0ZWQgb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7RXJyb3JDYWxsYmFja30gZXJyb3JDYWxsYmFjayBUaGUgY2FsbGJhY2sgdGhhdCB3aWxsIGJlIGludm9rZWQgb24gZXJyb3Igc2NlbmFyaW9zLlxuICAgICAqL1xuICAgIGRlbGV0ZSh0eXBlLCBpZCwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XG4gICAgICBpZiAoIWluaXRpYWxpemVkKSB7XG4gICAgICAgIGVycm9yQ2FsbGJhY2soU1RPUkFHRV9BUElfSU5JVElBTElaQVRJT05fRVJST1IpXG4gICAgICB9IGVsc2UgaWYgKCFpbml0aWFsaXplZE9iamVjdFN0b3Jlc1t0eXBlXSkge1xuICAgICAgICBlcnJvckNhbGxiYWNrKE9CSkVDVF9TVE9SRV9UWVBFX0lOSVRJQUxJWkFUSU9OX0VSUk9SKHR5cGUpKVxuICAgICAgfVxuICAgICAgdmFyIHN0b3JlID0gZ2V0U3RvcmFnZU9iamVjdCh0eXBlKVxuICAgICAgaWYgKHN0b3JlW2lkXSkge1xuICAgICAgICBkZWxldGUgc3RvcmVbaWRdXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHR5cGUsIEpTT04uc3RyaW5naWZ5KHN0b3JlKSlcbiAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGlkKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZXJyb3JDYWxsYmFjayhPQkpFQ1RfTk9UX0ZPVU5EX0VSUk9SKGlkKSlcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVGhpcyBjYW4gYmUgdXNlZCBmb3IgcXVlcnlpbmcgb2JqZWN0cyBiYXNlZCBvbiBhIHByb3BlcnR5IHZhbHVlLlxuICAgICAqIEEgc2luZ2xlIHByb3BlcnR5IG5hbWUgY2FuIGJlIHBhc3NlZCBpbiwgYWxvbmcgd2l0aCB0aGUgdmFsdWUgdGhhdCBtYXRjaGVzLlxuICAgICAqIEFueSBvYmplY3RzIHdpdGggdGhhdCB2YWx1ZSBmb3IgdGhlIHByb3BlcnR5IHNwZWNpZmllZCB3aWxsIGJlIHJldHVybmVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgVGhlIHR5cGUgb2Ygb2JqZWN0IHRoYXQgd2lsbCBiZSBzZWFyY2hlZCBmb3IuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHByb3BlcnR5TmFtZSBUaGUgcHJvcGVydHkgbmFtZSB0byBiZSBtYXRjaGVkLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gcHJvcGVydHlWYWx1ZSBUaGUgdmFsdWUgdGhhdCBwcm9wZXJ0eSBzaG91bGQgaGF2ZS5cbiAgICAgKiBAcGFyYW0ge1N1Y2Nlc3NDYWxsYmFja30gc3VjY2Vzc0NhbGxiYWNrIFRoZSBjYWxsYmFjayB0aGF0IHdpbGwgYmUgaW52b2tlZCBhZnRlciB0aGUgcXVlcnlcbiAgICAgKiBjb21wbGV0ZXMuIFRoaXMgd2lsbCBiZSBhbiBhcnJheSBvZiAwIG9yIG1vcmUgb2JqZWN0cyBvZiB0aGUgc3BlY2lmaWVkIHR5cGUuXG4gICAgICogQHBhcmFtIHtFcnJvckNhbGxiYWNrfSBlcnJvckNhbGxiYWNrIFRoZSBlcnJvciBjYWxsYmFjayB0aGF0IHdpbGwgYmUgaW52b2tlZCBvbiBlcnJvciBzY2VuYXJpb3MuXG4gICAgICovXG4gICAgZmluZEJ5UHJvcGVydHkoXG4gICAgICB0eXBlLFxuICAgICAgcHJvcGVydHlOYW1lLFxuICAgICAgcHJvcGVydHlWYWx1ZSxcbiAgICAgIHN1Y2Nlc3NDYWxsYmFjayxcbiAgICAgIGVycm9yQ2FsbGJhY2tcbiAgICApIHtcbiAgICAgIGlmICghaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgZXJyb3JDYWxsYmFjayhTVE9SQUdFX0FQSV9JTklUSUFMSVpBVElPTl9FUlJPUilcbiAgICAgIH0gZWxzZSBpZiAoIWluaXRpYWxpemVkT2JqZWN0U3RvcmVzW3R5cGVdKSB7XG4gICAgICAgIGVycm9yQ2FsbGJhY2soT0JKRUNUX1NUT1JFX1RZUEVfSU5JVElBTElaQVRJT05fRVJST1IodHlwZSkpXG4gICAgICB9XG4gICAgICB2YXIgcmVzdWx0ID0gW11cbiAgICAgIHZhciBzdG9yZSA9IGdldFN0b3JhZ2VPYmplY3QodHlwZSlcbiAgICAgICQuZWFjaChzdG9yZSwgZnVuY3Rpb24oXywgdikge1xuICAgICAgICBpZiAodltwcm9wZXJ0eU5hbWVdID09PSBwcm9wZXJ0eVZhbHVlKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2godilcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXN1bHQpXG4gICAgfSxcbiAgfVxufSkoKVxuIiwiLy8gcmVxdWlyZXM6IHRhc2tzLXdlYnN0b3JhZ2UuanNcbi8qKlxuICogQGZpbGVPdmVydmlldyBXZSB1c2UgdGhlIGBtb2R1bGVgIHBhdHRlcm4gdG8gZW5zdXJlIHRoaXMgYGNvbnRyb2xsZXJgIGNhbiBlbmNhcHN1bGF0ZSBkYXRhLFxuICogYW5kIGV4cG9zZSBhIHB1YmxpYyBBUEkgdG8gdGhlIHJlc3Qgb2YgdGhlIGFwcGxpY2F0aW9uLlxuICpcbiAqIFRoZSBjb250cm9sbGVyIHdpbGwgYmUgcmVzcG9uc2libGUgZm9yIGluaXRpYWxpemluZyB0aGUgZm9ybSwgaGFuZGxpbmcgZXZlbnRzLFxuICogYW5kIG1hbmFnaW5nIGFueSBzdGF0ZSByZXF1aXJlZCBieSB0aGUgcGFnZS5cbiAqIFVzaW5nIGFuIElJRkUgY3JlYXRlcyBhIGBzaW5nbGV0b25gLCB0aGlzIGlzIHJlcXVpcmVkIHNpbmNlIHRoZSBjb250cm9sbGVyXG4gKiBtYW5hZ2VzIG91ciBhcHBsaWNhdGlvbidzIHN0YXRlIChkYXRhICYgRE9NIG1hbmlwdWxhdGlvbilcbiAqXG4gKlxuICovXG5cbi8qKlxuICpcbiAqIEB0eXBlIHtPYmplY3R9IFRhc2tDb250cm9sbGVyXG4gKiBAcHJvcGVydHkge0Z1bmN0aW9ufSBpbml0IEluaXRpYWxpemUgdGhlIGNvbnRyb2xsZXJcbiAqXG4gKi9cbnZhciB0YXNrc0NvbnRyb2xsZXIgPSAoZnVuY3Rpb24oKSB7XG4gIC8qKiBAZ2xvYmFsIHN0b3JhZ2VFbmdpbmUgKi9cblxuICAvLyBUT0RPOiBob3cgdG8gc3BlY2lmeSB0aGlzIG9mIHR5cGUgRXJyb3JDYWxsYmFjaz9cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB7RXJyb3JPYmplY3R9IGVycm9yXG4gICAqL1xuICBmdW5jdGlvbiBlcnJvckxvZ2dlcihlcnJvcikge1xuICAgIGNvbnNvbGUubG9nKGAke2Vycm9yLmNvZGV9OiAke2Vycm9yLm1lc3NhZ2V9YClcbiAgfVxuXG4gIHZhciB0YXNrUGFnZVxuICB2YXIgaW5pdGlhbGlzZWQgPSBmYWxzZVxuXG4gIHJldHVybiB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gcGFnZSBBIHJlZmVyZW5jZSB0byB0aGUgRE9NIGVsZW1lbnQgdGhpcyBjb250cm9sbGVyXG4gICAgICogc2hvdWxkIGJlIGF0dGFjaGVkIHRvLlxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKHBhZ2UpIHtcbiAgICAgIHN0b3JhZ2VFbmdpbmUuaW5pdChmdW5jdGlvbigpIHtcbiAgICAgICAgc3RvcmFnZUVuZ2luZS5pbml0T2JqZWN0U3RvcmUoXCJ0YXNrXCIsIGZ1bmN0aW9uKCkge30sIGVycm9yTG9nZ2VyKVxuICAgICAgfSwgZXJyb3JMb2dnZXIpXG4gICAgICBpZiAoIWluaXRpYWxpc2VkKSB7XG4gICAgICAgIHRhc2tQYWdlID0gcGFnZVxuXG4gICAgICAgIC8vIHNldHVwIHVpIGVsZW1lbnQgdG8gc3BlY2lmeSByZXF1aXJlZCBmb3JtIGZpZWxkc1xuICAgICAgICAkKHRhc2tQYWdlKVxuICAgICAgICAgIC5maW5kKCdbcmVxdWlyZWQ9XCJyZXF1aXJlZFwiXScpXG4gICAgICAgICAgLnByZXYoXCJsYWJlbFwiKVxuICAgICAgICAgIC5hcHBlbmQoXCI8c3Bhbj4qPC9zcGFuPlwiKVxuICAgICAgICAgIC5jaGlsZHJlbihcInNwYW5cIilcbiAgICAgICAgICAuYWRkQ2xhc3MoXCJyZXF1aXJlZFwiKVxuXG4gICAgICAgIC8vIHNldHVwIHVpIHRvIG1ha2UgcmVhZGluZyB0aGUgdGFibGUgZWFzaWVyIGJ5IGNvbG9yaW5nIGFsdGVybmF0aW5nIHJvd3NcbiAgICAgICAgJCh0YXNrUGFnZSlcbiAgICAgICAgICAuZmluZChcInRib2R5IHRyOmV2ZW5cIilcbiAgICAgICAgICAuYWRkQ2xhc3MoXCJldmVuXCIpXG5cbiAgICAgICAgLy8gc2V0dXAgY2xpY2sgaGFuZGxlciB0byBkaXNwbGF5IHRhc2sgY3JlYXRpb24gZm9ybVxuICAgICAgICAkKHRhc2tQYWdlKVxuICAgICAgICAgIC5maW5kKFwiI2J0bkFkZFRhc2tcIilcbiAgICAgICAgICAuY2xpY2soZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgJCh0YXNrUGFnZSlcbiAgICAgICAgICAgICAgLmZpbmQoXCIjdGFza0NyZWF0aW9uXCIpXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcIm5vdFwiKVxuICAgICAgICAgIH0pXG5cbiAgICAgICAgLy8gc2V0dXAgY2xpY2sgaGFuZGxlciB0byBoaWdobGlnaHQgc2VsZWN0ZWQgcm93c1xuICAgICAgICAkKHRhc2tQYWdlKVxuICAgICAgICAgIC5maW5kKFwidGJvZHkgdHJcIilcbiAgICAgICAgICAuY2xpY2soZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgICAkKGV2dC50YXJnZXQpXG4gICAgICAgICAgICAgIC5jbG9zZXN0KFwidGRcIilcbiAgICAgICAgICAgICAgLnNpYmxpbmdzKClcbiAgICAgICAgICAgICAgLmFuZFNlbGYoKVxuICAgICAgICAgICAgICAudG9nZ2xlQ2xhc3MoXCJyb3dIaWdobGlnaHRcIilcbiAgICAgICAgICB9KVxuXG4gICAgICAgIC8vIHNldHVwIGNsaWNrIGhhbmRsZXIgdG8gZWRpdCByb3dcbiAgICAgICAgJCh0YXNrUGFnZSlcbiAgICAgICAgICAuZmluZChcIiN0YmxUYXNrcyB0Ym9keVwiKVxuICAgICAgICAgIC5vbihcImNsaWNrXCIsIFwiLmVkaXRSb3dcIiwgZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgICAkKHRhc2tQYWdlKVxuICAgICAgICAgICAgICAuZmluZChcIiN0YXNrQ3JlYXRpb25cIilcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwibm90XCIpXG4gICAgICAgICAgICBzdG9yYWdlRW5naW5lLmZpbmRCeUlkKFxuICAgICAgICAgICAgICBcInRhc2tcIixcbiAgICAgICAgICAgICAgJChldnQudGFyZ2V0KS5kYXRhKCkudGFza0lkLFxuICAgICAgICAgICAgICBmdW5jdGlvbih0YXNrKSB7XG4gICAgICAgICAgICAgICAgJCh0YXNrUGFnZSlcbiAgICAgICAgICAgICAgICAgIC5maW5kKFwiZm9ybVwiKVxuICAgICAgICAgICAgICAgICAgLmZyb21PYmplY3QodGFzaylcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZXJyb3JMb2dnZXJcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9KVxuXG4gICAgICAgIC8vIHNldHVwIGNsaWNrIGhhbmRsZXIgdG8gZGVsZXRlIHJvd1xuICAgICAgICAkKHRhc2tQYWdlKVxuICAgICAgICAgIC5maW5kKFwiI3RibFRhc2tzIHRib2R5XCIpXG4gICAgICAgICAgLm9uKFwiY2xpY2tcIiwgXCIuZGVsZXRlUm93XCIsIGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAgc3RvcmFnZUVuZ2luZS5kZWxldGUoXG4gICAgICAgICAgICAgIFwidGFza1wiLFxuICAgICAgICAgICAgICAkKGV2dC50YXJnZXQpLmRhdGEoKS50YXNrSWQsXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQoZXZ0LnRhcmdldClcbiAgICAgICAgICAgICAgICAgIC5wYXJlbnRzKFwidHJcIilcbiAgICAgICAgICAgICAgICAgIC5yZW1vdmUoKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBlcnJvckxvZ2dlclxuICAgICAgICAgICAgKVxuICAgICAgICAgIH0pXG5cbiAgICAgICAgLy8gc2V0dXAgY2xpY2sgaGFuZGxlciB0byBzYXZlIHRhc2sgdXNpbmcgb3VyIGpRdWVyeSBmb3JtIHBsdWdpblxuICAgICAgICAkKHRhc2tQYWdlKVxuICAgICAgICAgIC5maW5kKFwiI3NhdmVUYXNrXCIpXG4gICAgICAgICAgLmNsaWNrKGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgJCh0YXNrUGFnZSlcbiAgICAgICAgICAgICAgICAuZmluZChcImZvcm1cIilcbiAgICAgICAgICAgICAgICAudmFsaWQoKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHZhciB0YXNrID0gJChcImZvcm1cIikudG9PYmplY3QoKVxuICAgICAgICAgICAgICBzdG9yYWdlRW5naW5lLnNhdmUoXG4gICAgICAgICAgICAgICAgXCJ0YXNrXCIsXG4gICAgICAgICAgICAgICAgdGFzayxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihzYXZlZFRhc2spIHtcbiAgICAgICAgICAgICAgICAgICQoXCIjdGFza1Jvd1wiKVxuICAgICAgICAgICAgICAgICAgICAudG1wbChzYXZlZFRhc2spXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmRUbygkKHRhc2tQYWdlKS5maW5kKFwiI3RibFRhc2tzIHRib2R5XCIpKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3JMb2dnZXJcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIGluaXRpYWxpc2VkID0gdHJ1ZVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBsb2FkVGFza3M6IGZ1bmN0aW9uKCkge1xuICAgICAgc3RvcmFnZUVuZ2luZS5maW5kQWxsKFxuICAgICAgICBcInRhc2tcIixcbiAgICAgICAgZnVuY3Rpb24odGFza3MpIHtcbiAgICAgICAgICAkLmVhY2godGFza3MsIGZ1bmN0aW9uKGluZGV4LCB0YXNrKSB7XG4gICAgICAgICAgICAkKFwiI3Rhc2tSb3dcIilcbiAgICAgICAgICAgICAgLnRtcGwodGFzaylcbiAgICAgICAgICAgICAgLmFwcGVuZFRvKCQodGFza1BhZ2UpLmZpbmQoXCIjdGJsVGFza3MgdGJvZHlcIikpXG4gICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3JMb2dnZXJcbiAgICAgIClcbiAgICB9LFxuICB9XG59KSgpXG4iXX0=
